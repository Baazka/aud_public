const oracledb = require("oracledb");
const database = require("../services/database.js");

const baseQuery = `SELECT 
CD.DEPARTMENT_NAME,
CASE WHEN RBT.BUDGET_TYPE_ID = 3 AND SD.BUDGET_TYPE_ID = 5 THEN 'Анхан шатны эмнэлэг' ELSE RBT.BUDGET_SHORT_NAME END BUDGET_NAME,
COUNT(DISTINCT(SD.SURVEY_AUDIT_ID)) SEND,
COUNT(DISTINCT(CASE WHEN EE.ENT_ID IS NOT NULL THEN SD.SURVEY_AUDIT_ID ELSE NULL END)) SENT,
COUNT(DISTINCT(SD.SURVEY_AUDIT_ID)) - COUNT(DISTINCT(CASE WHEN EE.ENT_ID IS NOT NULL THEN SD.SURVEY_AUDIT_ID ELSE NULL END)) ZURUU,
SUM(CASE WHEN SD.SURVEY_ID = 1 THEN SD.REQ ELSE 0 END) S1_REQ, 
SUM(CASE WHEN SD.SURVEY_ID = 1 THEN SD.RES ELSE 0 END) S1_RES, 
SUM(CASE WHEN SD.SURVEY_ID = 1 THEN SD.RES_CNT ELSE 0 END) S1_RES_CNT, 
SUM(CASE WHEN SD.SURVEY_ID = 1 AND SD.SURVEY_STATUS_ID = 5 THEN 1 ELSE 0 END) S1_CONFIRM, 
SUM(CASE WHEN SD.SURVEY_ID = 1 AND SD.SURVEY_STATUS_ID = 1 THEN 1 ELSE 0 END) S1_NEW, 
SUM(CASE WHEN SD.SURVEY_ID = 1 AND SD.SURVEY_STATUS_ID = 2 THEN 1 ELSE 0 END) S1_SAVE, 
SUM(CASE WHEN SD.SURVEY_ID = 1 AND SD.SURVEY_STATUS_ID = 3 THEN 1 ELSE 0 END) S1_SENT, 
SUM(CASE WHEN SD.SURVEY_ID = 1 AND SD.SURVEY_STATUS_ID = 4 THEN 1 ELSE 0 END) S1_HAM, 
SUM(CASE WHEN SD.SURVEY_ID = 1 AND SD.SURVEY_STATUS_ID = 6 THEN 1 ELSE 0 END) S1_RETURN,

SUM(CASE WHEN SD.SURVEY_ID = 2 THEN SD.REQ ELSE 0 END) S21_REQ, 
SUM(CASE WHEN SD.SURVEY_ID = 2 THEN SD.RES ELSE 0 END) S21_RES, 
SUM(CASE WHEN SD.SURVEY_ID = 2 THEN SD.RES_CNT ELSE 0 END) S21_RES_CNT, 
SUM(CASE WHEN SD.SURVEY_ID = 2 AND SD.SURVEY_STATUS_ID = 5 AND SD.SURVEY_ID = 2 THEN 1 ELSE 0 END) S21_CONFIRM, 
SUM(CASE WHEN SD.SURVEY_ID = 2 AND SD.SURVEY_STATUS_ID = 1 AND SD.SURVEY_ID = 2 THEN 1 ELSE 0 END) S21_NEW, 
SUM(CASE WHEN SD.SURVEY_ID = 2 AND SD.SURVEY_STATUS_ID = 2 AND SD.SURVEY_ID = 2 THEN 1 ELSE 0 END) S21_SAVE, 
SUM(CASE WHEN SD.SURVEY_ID = 2 AND SD.SURVEY_STATUS_ID = 3 AND SD.SURVEY_ID = 2 THEN 1 ELSE 0 END) S21_SENT, 
SUM(CASE WHEN SD.SURVEY_ID = 2 AND SD.SURVEY_STATUS_ID = 4 AND SD.SURVEY_ID = 2 THEN 1 ELSE 0 END) S21_HAM, 
SUM(CASE WHEN SD.SURVEY_ID = 2 AND SD.SURVEY_STATUS_ID = 6 AND SD.SURVEY_ID = 2 THEN 1 ELSE 0 END) S21_RETURN,

SUM(CASE WHEN SD.SURVEY_ID = 3 THEN SD.REQ ELSE 0 END) S22_BUG, 
SUM(CASE WHEN SD.SURVEY_ID = 3 THEN SD.RES ELSE 0 END) S22_BUG, 
SUM(CASE WHEN SD.SURVEY_ID = 3 THEN SD.RES_CNT ELSE 0 END) S22_RES_CNT, 
SUM(CASE WHEN SD.SURVEY_ID = 3 AND SD.SURVEY_STATUS_ID = 5 AND SD.SURVEY_ID = 3 THEN 1 ELSE 0 END) S22_CONFIRM, 
SUM(CASE WHEN SD.SURVEY_ID = 3 AND SD.SURVEY_STATUS_ID = 1 AND SD.SURVEY_ID = 3 THEN 1 ELSE 0 END) S22_NEW, 
SUM(CASE WHEN SD.SURVEY_ID = 3 AND SD.SURVEY_STATUS_ID = 2 AND SD.SURVEY_ID = 3 THEN 1 ELSE 0 END) S22_SAVE, 
SUM(CASE WHEN SD.SURVEY_ID = 3 AND SD.SURVEY_STATUS_ID = 3 AND SD.SURVEY_ID = 3 THEN 1 ELSE 0 END) S22_SENT, 
SUM(CASE WHEN SD.SURVEY_ID = 3 AND SD.SURVEY_STATUS_ID = 4 AND SD.SURVEY_ID = 3 THEN 1 ELSE 0 END) S22_HAM, 
SUM(CASE WHEN SD.SURVEY_ID = 3 AND SD.SURVEY_STATUS_ID = 6 AND SD.SURVEY_ID = 3 THEN 1 ELSE 0 END) S22_RETURN,

SUM(CASE WHEN SD.SURVEY_ID = 4 THEN SD.REQ ELSE 0 END) S23_REQ, 
SUM(CASE WHEN SD.SURVEY_ID = 4 THEN SD.RES ELSE 0 END) S23_RES, 
SUM(CASE WHEN SD.SURVEY_ID = 4 THEN SD.RES_CNT ELSE 0 END) S23_RES_CNT, 
SUM(CASE WHEN SD.SURVEY_ID = 4 AND SD.SURVEY_STATUS_ID = 5 THEN 1 ELSE 0 END) S23_CONFIRM, 
SUM(CASE WHEN SD.SURVEY_ID = 4 AND SD.SURVEY_STATUS_ID = 1 THEN 1 ELSE 0 END) S23_NEW, 
SUM(CASE WHEN SD.SURVEY_ID = 4 AND SD.SURVEY_STATUS_ID = 2 THEN 1 ELSE 0 END) S23_SAVE, 
SUM(CASE WHEN SD.SURVEY_ID = 4 AND SD.SURVEY_STATUS_ID = 3 THEN 1 ELSE 0 END) S23_SENT, 
SUM(CASE WHEN SD.SURVEY_ID = 4 AND SD.SURVEY_STATUS_ID = 4 THEN 1 ELSE 0 END) S23_HAM, 
SUM(CASE WHEN SD.SURVEY_ID = 4 AND SD.SURVEY_STATUS_ID = 6 THEN 1 ELSE 0 END) S23_RETURN,

SUM(CASE WHEN SD.SURVEY_ID = 5 THEN SD.REQ ELSE 0 END) S3_REQ, 
SUM(CASE WHEN SD.SURVEY_ID = 5 THEN SD.RES ELSE 0 END) S3_RES, 
SUM(CASE WHEN SD.SURVEY_ID = 5 THEN SD.RES_CNT ELSE 0 END) S3_RES_CNT, 
SUM(CASE WHEN SD.SURVEY_ID = 5 AND SD.SURVEY_STATUS_ID = 5 THEN 1 ELSE 0 END) S3_CONFIRM, 
SUM(CASE WHEN SD.SURVEY_ID = 5 AND SD.SURVEY_STATUS_ID = 1 THEN 1 ELSE 0 END) S3_NEW, 
SUM(CASE WHEN SD.SURVEY_ID = 5 AND SD.SURVEY_STATUS_ID = 2 THEN 1 ELSE 0 END) S3_SAVE, 
SUM(CASE WHEN SD.SURVEY_ID = 5 AND SD.SURVEY_STATUS_ID = 3 THEN 1 ELSE 0 END) S3_SENT, 
SUM(CASE WHEN SD.SURVEY_ID = 5 AND SD.SURVEY_STATUS_ID = 4 THEN 1 ELSE 0 END) S3_HAM, 
SUM(CASE WHEN SD.SURVEY_ID = 5 AND SD.SURVEY_STATUS_ID = 6 THEN 1 ELSE 0 END) S3_RETURN,

SUM(CASE WHEN SD.SURVEY_ID = 6 THEN SD.REQ ELSE 0 END) S4_REQ, 
SUM(CASE WHEN SD.SURVEY_ID = 6 THEN SD.RES ELSE 0 END) S4_RES, 
SUM(CASE WHEN SD.SURVEY_ID = 6 THEN SD.RES_CNT ELSE 0 END) S4_RES_CNT, 
SUM(CASE WHEN SD.SURVEY_ID = 6 AND SD.SURVEY_STATUS_ID = 5 THEN 1 ELSE 0 END) S4_CONFIRM, 
SUM(CASE WHEN SD.SURVEY_ID = 6 AND SD.SURVEY_STATUS_ID = 1 THEN 1 ELSE 0 END) S4_NEW, 
SUM(CASE WHEN SD.SURVEY_ID = 6 AND SD.SURVEY_STATUS_ID = 2 THEN 1 ELSE 0 END) S4_SAVE, 
SUM(CASE WHEN SD.SURVEY_ID = 6 AND SD.SURVEY_STATUS_ID = 3 THEN 1 ELSE 0 END) S4_SENT, 
SUM(CASE WHEN SD.SURVEY_ID = 6 AND SD.SURVEY_STATUS_ID = 4 THEN 1 ELSE 0 END) S4_HAM, 
SUM(CASE WHEN SD.SURVEY_ID = 6 AND SD.SURVEY_STATUS_ID = 6 THEN 1 ELSE 0 END) S4_RETURN,

SUM(CASE WHEN SD.SURVEY_ID = 7 THEN SD.REQ ELSE 0 END) S5_REQ, 
SUM(CASE WHEN SD.SURVEY_ID = 7 THEN SD.RES ELSE 0 END) S5_RES, 
SUM(CASE WHEN SD.SURVEY_ID = 7 THEN SD.RES_CNT ELSE 0 END) S5_RES_CNT, 
SUM(CASE WHEN SD.SURVEY_ID = 7 AND SD.SURVEY_STATUS_ID = 5 THEN 1 ELSE 0 END) S5_CONFIRM, 
SUM(CASE WHEN SD.SURVEY_ID = 7 AND SD.SURVEY_STATUS_ID = 1 THEN 1 ELSE 0 END) S5_NEW,
SUM(CASE WHEN SD.SURVEY_ID = 7 AND SD.SURVEY_STATUS_ID = 2 THEN 1 ELSE 0 END) S5_SAVE, 
SUM(CASE WHEN SD.SURVEY_ID = 7 AND SD.SURVEY_STATUS_ID = 3 THEN 1 ELSE 0 END) S5_SENT, 
SUM(CASE WHEN SD.SURVEY_ID = 7 AND SD.SURVEY_STATUS_ID = 4 THEN 1 ELSE 0 END) S5_HAM,  
SUM(CASE WHEN SD.SURVEY_ID = 7 AND SD.SURVEY_STATUS_ID = 6 THEN 1 ELSE 0 END) S5_RETURN,

SUM(CASE WHEN SD.SURVEY_ID = 8 THEN SD.REQ ELSE 0 END) S6_REQ, 
SUM(CASE WHEN SD.SURVEY_ID = 8 THEN SD.RES ELSE 0 END) S6_RES,
SUM(CASE WHEN SD.SURVEY_ID = 8 THEN SD.RES_CNT ELSE 0 END) S6_RES_CNT,  
SUM(CASE WHEN SD.SURVEY_ID = 8 AND SD.SURVEY_STATUS_ID = 5 THEN 1 ELSE 0 END) S6_CONFIRM,  
SUM(CASE WHEN SD.SURVEY_ID = 8 AND SD.SURVEY_STATUS_ID = 1 THEN 1 ELSE 0 END) S6_NEW, 
SUM(CASE WHEN SD.SURVEY_ID = 8 AND SD.SURVEY_STATUS_ID = 2 THEN 1 ELSE 0 END) S6_SAVE, 
SUM(CASE WHEN SD.SURVEY_ID = 8 AND SD.SURVEY_STATUS_ID = 3 THEN 1 ELSE 0 END) S6_SENT, 
SUM(CASE WHEN SD.SURVEY_ID = 8 AND SD.SURVEY_STATUS_ID = 4 THEN 1 ELSE 0 END) S6_HAM, 
SUM(CASE WHEN SD.SURVEY_ID = 8 AND SD.SURVEY_STATUS_ID = 6 THEN 1 ELSE 0 END) S6_RETURN, 

SUM(CASE WHEN SD.SURVEY_ID = 9 THEN SD.REQ ELSE 0 END) S7_REQ, 
SUM(CASE WHEN SD.SURVEY_ID = 9 THEN SD.RES ELSE 0 END) S7_RES,  
SUM(CASE WHEN SD.SURVEY_ID = 9 THEN SD.RES_CNT ELSE 0 END) S7_RES_CNT, 
SUM(CASE WHEN SD.SURVEY_ID = 9 AND SD.SURVEY_STATUS_ID = 5 THEN 1 ELSE 0 END) S7_CONFIRM, 
SUM(CASE WHEN SD.SURVEY_ID = 9 AND SD.SURVEY_STATUS_ID = 1 THEN 1 ELSE 0 END) S7_NEW, 
SUM(CASE WHEN SD.SURVEY_ID = 9 AND SD.SURVEY_STATUS_ID = 2 THEN 1 ELSE 0 END) S7_SAVE, 
SUM(CASE WHEN SD.SURVEY_ID = 9 AND SD.SURVEY_STATUS_ID = 3 THEN 1 ELSE 0 END) S7_SENT, 
SUM(CASE WHEN SD.SURVEY_ID = 9 AND SD.SURVEY_STATUS_ID = 4 THEN 1 ELSE 0 END) S7_HAM, 
SUM(CASE WHEN SD.SURVEY_ID = 9 AND SD.SURVEY_STATUS_ID = 6 THEN 1 ELSE 0 END) S7_RETURN,

SUM(CASE WHEN SD.SURVEY_ID = 10 THEN SD.REQ ELSE 0 END) S8_REQ, 
SUM(CASE WHEN SD.SURVEY_ID = 10 THEN SD.RES ELSE 0 END) S8_RES, 
SUM(CASE WHEN SD.SURVEY_ID = 10 THEN SD.RES_CNT ELSE 0 END) S8_RES_CNT, 
SUM(CASE WHEN SD.SURVEY_ID = 10 AND SD.SURVEY_STATUS_ID = 5 THEN 1 ELSE 0 END) S8_CONFIRM, 
SUM(CASE WHEN SD.SURVEY_ID = 10 AND SD.SURVEY_STATUS_ID = 1 THEN 1 ELSE 0 END) S8_NEW, 
SUM(CASE WHEN SD.SURVEY_ID = 10 AND SD.SURVEY_STATUS_ID = 2 THEN 1 ELSE 0 END) S8_SAVE, 
SUM(CASE WHEN SD.SURVEY_ID = 10 AND SD.SURVEY_STATUS_ID = 3 THEN 1 ELSE 0 END) S8_SENT, 
SUM(CASE WHEN SD.SURVEY_ID = 10 AND SD.SURVEY_STATUS_ID = 4 THEN 1 ELSE 0 END) S8_HAM, 
SUM(CASE WHEN SD.SURVEY_ID = 10 AND SD.SURVEY_STATUS_ID = 6 THEN 1 ELSE 0 END) S8_RETURN,

SUM(CASE WHEN SD.SURVEY_ID = 11 THEN SD.REQ ELSE 0 END) S9_REQ, 
SUM(CASE WHEN SD.SURVEY_ID = 11 THEN SD.RES ELSE 0 END) S9_RES,
SUM(CASE WHEN SD.SURVEY_ID = 11 THEN SD.RES_CNT ELSE 0 END) S9_RES_CNT, 
SUM(CASE WHEN SD.SURVEY_ID = 11 AND SD.SURVEY_STATUS_ID = 5 THEN 1 ELSE 0 END) S9_CONFIRM, 
SUM(CASE WHEN SD.SURVEY_ID = 11 AND SD.SURVEY_STATUS_ID = 1 THEN 1 ELSE 0 END) S9_NEW,  
SUM(CASE WHEN SD.SURVEY_ID = 11 AND SD.SURVEY_STATUS_ID = 2 THEN 1 ELSE 0 END) S9_SAVE, 
SUM(CASE WHEN SD.SURVEY_ID = 11 AND SD.SURVEY_STATUS_ID = 3 THEN 1 ELSE 0 END) S9_SENT, 
SUM(CASE WHEN SD.SURVEY_ID = 11 AND SD.SURVEY_STATUS_ID = 4 THEN 1 ELSE 0 END) S9_HAM, 
SUM(CASE WHEN SD.SURVEY_ID = 11 AND SD.SURVEY_STATUS_ID = 6 THEN 1 ELSE 0 END) S9_RETURN,

SUM(CASE WHEN SD.SURVEY_ID = 12 THEN SD.REQ ELSE 0 END) S10_REQ, 
SUM(CASE WHEN SD.SURVEY_ID = 12 THEN SD.RES ELSE 0 END) S10_RES,
SUM(CASE WHEN SD.SURVEY_ID = 12 THEN SD.RES_CNT ELSE 0 END) S10_RES_CNT,  
SUM(CASE WHEN SD.SURVEY_ID = 12 AND SD.SURVEY_STATUS_ID = 5 THEN 1 ELSE 0 END) S10_CONFIRM, 
SUM(CASE WHEN SD.SURVEY_ID = 12 AND SD.SURVEY_STATUS_ID = 1 THEN 1 ELSE 0 END) S10_NEW, 
SUM(CASE WHEN SD.SURVEY_ID = 12 AND SD.SURVEY_STATUS_ID = 2 THEN 1 ELSE 0 END) S10_SAVE, 
SUM(CASE WHEN SD.SURVEY_ID = 12 AND SD.SURVEY_STATUS_ID = 3 THEN 1 ELSE 0 END) S10_SENT, 
SUM(CASE WHEN SD.SURVEY_ID = 12 AND SD.SURVEY_STATUS_ID = 4 THEN 1 ELSE 0 END) S10_HAM, 
SUM(CASE WHEN SD.SURVEY_ID = 12 AND SD.SURVEY_STATUS_ID = 6 THEN 1 ELSE 0 END) S10_RETURN
FROM AUD_PUBLIC.REG_SURVEY_DETAIL SD
INNER JOIN FAS_ADMIN.FAS_AUDIT FA ON SD.SURVEY_AUDIT_ID = FA.ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID 
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
LEFT JOIN FAS_ADMIN.FAS_DOCUMENT_DATA FDD ON FA.ID = FDD.FAS_AUDIT_ID AND FDD.IS_ACTIVE = 1 AND FDD.IND_ID IN (287, 344)
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ID = EE.FAS_AUDIT_ID AND FA.ENT_ID = EE.ENT_ID
WHERE FA.IS_ACTIVE = 1 AND AE.IS_ACTIVE = 1 AND FA.ID != 3322 
GROUP BY CD.ID, CD.DEPARTMENT_NAME, RBT.BUDGET_TYPE_ID, SD.BUDGET_TYPE_ID, RBT.BUDGET_SHORT_NAME, FA.CHECK_DEPARTMENT_ID
ORDER BY CD.ID, RBT.BUDGET_TYPE_ID, SD.BUDGET_TYPE_ID,RBT.BUDGET_SHORT_NAME`;

async function postGuitsetgel(context) {
  let query = baseQuery;

  const binds = {};

  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postGuitsetgel = postGuitsetgel;

const baseUnsentQuery = `SELECT 
FA.ID,
CD.DEPARTMENT_NAME,
FA.AUDIT_CODE,
NVL(FDD.IND_VALUE,AE.ENT_NAME) ENT_NAME, 
CASE WHEN RBT.BUDGET_TYPE_ID = 3 AND SE.BUDGET_TYPE_ID = 5 THEN 'Анхан шатны эмнэлэг' ELSE RBT.BUDGET_SHORT_NAME END BUDGET_NAME,
AO.ORG_REGISTER_NO,
EE.EMAIL
FROM FAS_ADMIN.FAS_AUDIT FA 
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID 
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
LEFT JOIN FAS_ADMIN.FAS_DOCUMENT_DATA FDD ON FA.ID = FDD.FAS_AUDIT_ID AND FDD.IS_ACTIVE = 1 AND FDD.IND_ID IN (287, 344)
INNER JOIN AUD_PUBLIC.REF_SURVEY_ENTITY SE ON FA.ID = SE.SURVEY_AUDIT_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ID = EE.FAS_AUDIT_ID AND FA.ENT_ID = EE.ENT_ID
INNER JOIN AUD_PUBLIC.REF_SURVEY_CONFIG SC ON SE.BUDGET_TYPE_ID = SC.BUDGET_TYPE_ID 
LEFT JOIN AUD_PUBLIC.REG_SURVEY RS ON SC.SURVEY_ID = RS.SURVEY_ID AND FA.ID = RS.SURVEY_AUDIT_ID
WHERE FA.IS_ACTIVE = 1 AND AE.IS_ACTIVE = 1 AND FA.ID != 3322 AND EE.EMAIL IS NOT NULL AND RS.SURVEY_STATUS_ID = 1`;

async function postUnsent(context) {
  let query = baseUnsentQuery;

  const binds = {};
  binds.SURVEY_ID = context.survey_id;
  query += `\nAND SC.SURVEY_ID = :SURVEY_ID`;

  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY CD.ID, RBT.BUDGET_TYPE_ID, SE.BUDGET_TYPE_ID, RBT.BUDGET_SHORT_NAME`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postUnsent = postUnsent;

const baseQueryaAuditor = `SELECT FA.ID, FA.ENT_ID, FA.AUDIT_CODE, NVL(FDD.IND_VALUE,AE.ENT_NAME) ENT_NAME, 
CASE WHEN RBT.BUDGET_TYPE_ID = 3 AND SE.BUDGET_TYPE_ID = 5 THEN 'Анхан шатны эмнэлэг' ELSE RBT.BUDGET_SHORT_NAME END BUDGET_NAME,
COUNT(SC.SURVEY_ID) CNT_TOTAL,
SUM(CASE WHEN RS.SURVEY_STATUS_ID = 1 THEN 1 ELSE 0 END) CNT_NEW, 
SUM(CASE WHEN RS.SURVEY_STATUS_ID = 2 THEN 1 ELSE 0 END) CNT_SAVE, 
SUM(CASE WHEN RS.SURVEY_STATUS_ID = 3 THEN 1 ELSE 0 END) CNT_SENT, 
SUM(CASE WHEN RS.SURVEY_STATUS_ID = 4 THEN 1 ELSE 0 END) CNT_HAM, 
SUM(CASE WHEN RS.SURVEY_STATUS_ID = 5 THEN 1 ELSE 0 END) CNT_CONFIRM, 
SUM(CASE WHEN RS.SURVEY_STATUS_ID = 6 THEN 1 ELSE 0 END) CNT_RETURN
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON EE.CREATED_BY = SU.USER_ID
LEFT JOIN FAS_ADMIN.FAS_DOCUMENT_DATA FDD ON FA.ID = FDD.FAS_AUDIT_ID AND FDD.IS_ACTIVE = 1 AND FDD.IND_ID IN (287, 344)
LEFT JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_ENTITY SE ON FA.ID = SE.SURVEY_AUDIT_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_CONFIG SC ON SE.BUDGET_TYPE_ID = SC.BUDGET_TYPE_ID 
LEFT JOIN AUD_PUBLIC.REG_SURVEY RS ON SC.SURVEY_ID = RS.SURVEY_ID AND FA.ID = RS.SURVEY_AUDIT_ID
WHERE FA.IS_ACTIVE = 1 AND AE.IS_ACTIVE = 1 `;

async function postAuditorZadargaa(context) {
  let query = baseQueryaAuditor;

  const binds = {};
  if (context.usertype === "ADMIN") {
    query += `\n AND 1 = 1 `;
  } else {
    binds.USER_ID = context.userid;
    query += `\n AND CASE WHEN EE.UPDATED_BY IS NULL THEN EE.CREATED_BY ELSE EE.UPDATED_BY END = :USER_ID`;
  }
  query += `\n GROUP BY FA.ID, FA.ENT_ID, FA.AUDIT_CODE, NVL(FDD.IND_VALUE,AE.ENT_NAME),
  CASE WHEN RBT.BUDGET_TYPE_ID = 3 AND SE.BUDGET_TYPE_ID = 5 THEN 'Анхан шатны эмнэлэг' ELSE RBT.BUDGET_SHORT_NAME END`;
  query += `\n ORDER BY NVL(FDD.IND_VALUE,AE.ENT_NAME)`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postAuditorZadargaa = postAuditorZadargaa;

//Zadargaa tailan
const baseZad01Query = `SELECT FA.CHECK_DEPARTMENT_ID, CD.DEPARTMENT_NAME, 
SU.USER_NAME ||'-'|| SU.USER_CODE AUDITOR_NAME,
AE.ENT_NAME, AO.ORG_REGISTER_NO, RBT.BUDGET_SHORT_NAME, 
RS1.BUDGET_AMOUNT, RS1.RUNNING_COST_AMOUNT, RS1.INVESTMENT_COST_AMOUNT, RS1.EXECUTION_AMOUNT, RS1.EXECUTION_RUNNING_COST, RS1.EXECUTION_INVESTMENT_COST, RS1.HEMNELT_DUN, 
RS1.NEW_EMP_COUNT, RS1.NEW_EMP_SALARY, RS1.RENEW_EMP_COUNT, RS1.RENEW_EMP_SALARY, RS1.IMP_SALARY_COUNT, RS1.IMP_SALARY_AMOUNT, RS1.IMP_PROMO_COUNT, RS1.IMP_PROMO_AMOUNT, RS1.IMP_GUEST_AMOUNT, RS1.IMP_GIFT_AMOUNT, 
RS1.CAR_COUNT, RS1.CAR_AMOUNT, RS1.FURNITURE_AMOUNT, RS1.CLOTHES_AMOUNT, RS1.OTHER_TOOLS_AMOUNT, RS1.EXTERNAL_EVENT_AMOUNT, RS1.INTERNAL_EVENT_AMOUNT, RS1.CEREMONY_AMOUNT, RS1.CONTENT_AMOUNT, RS1.BASE_PLAN_AMOUNT, 
RS1.BASE_COMPLETION_AMOUNT, RS1.DOCUMENT_PLAN_AMOUNT, RS1.DOCUMENT_COMPLETION_AMOUNT,
RS.SURVEY_STATUS_ID, SS.STATUS_NAME
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_PUBLIC.REG_SURVEY RS ON FA.ID = RS.SURVEY_AUDIT_ID
INNER JOIN AUD_PUBLIC.REG_SURVEY_1 RS1 ON RS.ID = RS1.SURVEY_ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON NVL(EE.UPDATED_BY, EE.CREATED_BY) = SU.USER_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_STATUS SS ON RS.SURVEY_STATUS_ID = SS.ID
WHERE FA.IS_ACTIVE = 1 AND RS1.IS_ACTIVE = 1 AND FA.ID != 3322`;

async function postZad01(context) {
  let query = baseZad01Query;

  const binds = {};
  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY FA.CHECK_DEPARTMENT_ID, RS.ID, AO.ORG_REGISTER_NO`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postZad01 = postZad01;

const baseZad21Query = `SELECT FA.CHECK_DEPARTMENT_ID, CD.DEPARTMENT_NAME,   
SU.USER_NAME ||'-'|| SU.USER_CODE AUDITOR_NAME,
AE.ENT_NAME, AO.ORG_REGISTER_NO, RBT.BUDGET_SHORT_NAME,
RB.BRANCH_NAME ,
RS1.ACTIVITY_NAME ,
RS1.HOLDING_PERCENT ,
RS1.REG_DATE ,
RS1.REG_DOCUMENT_NO ,
CASE WHEN RS1.IS_LEGAL18 = 1 THEN 'Тийм' ELSE 'Үгүй' END IS_LEGAL18,
RS1.REG_CAPITAL_AMOUNT ,
RS1.STATE_CAPITAL_AMOUNT ,
RS1.STRUCTURE_DATE ,
RS1.STRUCTURE_DOCUMENT_NO ,
RS1.HEAD_EMPLOYEE ,
RS1.MIDDLE_EMPLOYEE ,
RS1.NORMAL_EMPLOYEE ,
RS1.TOTAL_EMPLOYEE ,
RS1.PROFIT_PLAN ,
RS1.PROFIT_COMPLETION ,
null,
CASE WHEN RS1.TARGET_LEVEL = 1 THEN 'Тийм' ELSE 'Үгүй' END TARGET_LEVEL,
RS1.TARGET_LEVEL_PERCENT ,
RS1.TARGET_LEVEL_DESCRIPTION ,
RS1.PREV_INCOME ,
RS1.PREV_PROCESS_COST ,
RS1.PREV_NON_PROCESS_COST ,
RS1.PREV_INCOME_TAX ,
RS1.PREV_PROFIT ,
RS1.PREV_DESCRIPTION ,
RS1.CY_INCOME ,
RS1.CY_PROCESS_COST ,
RS1.CY_NON_PROCESS_COST ,
RS1.CY_INCOME_TAX ,
RS1.CY_PROFIT ,
RS1.CY_DESCRIPTION ,
CASE WHEN RS1.IS_STATE = 1 THEN 'Тийм' ELSE 'Үгүй' END IS_STATE,
RS1.IS_STATE_DESCRIPTION ,
CASE WHEN RS1.IS_CHANGE = 1 THEN 'Тийм' ELSE 'Үгүй' END IS_CHANGE,
RS1.IS_CHANGE_DESCRIPTION ,
CASE WHEN RS1.IS_LINKED = 1 THEN 'Тийм' ELSE 'Үгүй' END IS_LINKED,
RS1.IS_LINKED_DESCRIPTION ,
CASE WHEN RS1.IS_SCOPED = 1 THEN 'Тийм' ELSE 'Үгүй' END IS_SCOPED,
RS1.IS_SCOPED_DESCRIPTION ,
RS1.PREV_SALARY_COST ,
RS1.PREV_PROMOTION_COST ,
RS1.PREV_GUEST_COST ,
RS1.CY_SALARY_COST ,
RS1.CY_PROMOTION_COST ,
RS1.CY_GUEST_COST,
RS.SURVEY_STATUS_ID, SS.STATUS_NAME
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_PUBLIC.REG_SURVEY RS ON FA.ID = RS.SURVEY_AUDIT_ID
INNER JOIN AUD_PUBLIC.REG_SURVEY_2_1 RS1 ON RS.ID = RS1.SURVEY_ID
INNER JOIN AUD_PUBLIC.REF_BRANCH RB ON RS1.BRANCH_ID = RB.ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON NVL(EE.UPDATED_BY, EE.CREATED_BY) = SU.USER_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_STATUS SS ON RS.SURVEY_STATUS_ID = SS.ID
WHERE FA.IS_ACTIVE = 1 AND RS1.IS_ACTIVE = 1 AND FA.ID != 3322`;

async function postZad21(context) {
  let query = baseZad21Query;

  const binds = {};
  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY FA.CHECK_DEPARTMENT_ID, RS.ID, AO.ORG_REGISTER_NO`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postZad21 = postZad21;

const baseZad22Query = `SELECT FA.CHECK_DEPARTMENT_ID, CD.DEPARTMENT_NAME,  
SU.USER_NAME ||'-'|| SU.USER_CODE AUDITOR_NAME,
AE.ENT_NAME, AO.ORG_REGISTER_NO, RBT.BUDGET_SHORT_NAME,
RS1.RECEIVE_PREV_AMOUNT ,
RS1.RECEIVE_CY_AMOUNT ,
RS1.RECEIVE_DESCRIPTION ,
RS1.NONASSET_PREV_AMOUNT ,
RS1.NONASSET_CY_AMOUNT ,
RS1.NONASSET_DESCRIPTION ,
RS1.DEBT_PREV_AMOUNT ,
RS1.DEBT_CY_AMOUNT ,
RS1.DEBT_DESCRIPTION ,
RS1.LONG_DEBT_PREV_AMOUNT ,
RS1.LONG_DEBT_CY_AMOUNT ,
RS1.LONG_DEBT_DESCRIPTION ,
RS1.LONG_DEBT_PAYMENT ,
CASE WHEN RS1.LONG_DEBT_IS_COMPLETE = 1 THEN 'Тийм' ELSE 'Үгүй' END LONG_DEBT_IS_COMPLETE,
RS1.PROPERTY_PREV_AMOUNT ,
RS1.PROPERTY_CY_AMOUNT ,
RS1.PROPERTY_DESCRIPTION ,
RS1.INCOME_PREV_AMOUNT ,
RS1.INCOME_CY_AMOUNT ,
RS1.INCOME_DESCRIPTION ,
RS1.PROFIT_PREV_AMOUNT ,
RS1.PROFIT_CY_AMOUNT ,
RS1.INVEST_ORG_PREV_AMOUNT ,
RS1.INVEST_ORG_CY_AMOUNT ,
RS1.INVEST_STATE_PREV_AMOUNT ,
RS1.INVEST_STATE_CY_AMOUNT ,
RS1.INVEST_LOCAL_PREV_AMOUNT ,
RS1.INVEST_LOCAL_CY_AMOUNT ,
RS1.INVEST_PROJECT_PREV_AMOUNT ,
RS1.INVEST_PROJECT_CY_AMOUNT,
RS.SURVEY_STATUS_ID, SS.STATUS_NAME
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_PUBLIC.REG_SURVEY RS ON FA.ID = RS.SURVEY_AUDIT_ID
INNER JOIN AUD_PUBLIC.REG_SURVEY_2_2 RS1 ON RS.ID = RS1.SURVEY_ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON NVL(EE.UPDATED_BY, EE.CREATED_BY) = SU.USER_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_STATUS SS ON RS.SURVEY_STATUS_ID = SS.ID
WHERE FA.IS_ACTIVE = 1 AND RS1.IS_ACTIVE = 1 AND FA.ID != 3322`;

async function postZad22(context) {
  let query = baseZad22Query;

  const binds = {};
  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY FA.CHECK_DEPARTMENT_ID, RS.ID, AO.ORG_REGISTER_NO`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postZad22 = postZad22;

const baseZad23Query = `SELECT FA.CHECK_DEPARTMENT_ID, CD.DEPARTMENT_NAME, 
SU.USER_NAME ||'-'|| SU.USER_CODE AUDITOR_NAME,
AE.ENT_NAME, AO.ORG_REGISTER_NO, RBT.BUDGET_SHORT_NAME,
RS1.HEAD_ROLE ,
RS1.HEAD_DATE ,
RS1.HEAD_DOCUMENT_NO ,
RS1.HEAD_LASTNAME ,
RS1.HEAD_FIRSTNAME ,
RS1.HEAD_ORGANIZATION ,
RS1.HEAD_ORG_ROLE ,
RS1.HEAD_SALARY ,
RS1.HEAD_PROMOTION ,
RS1.SUPPORT_DATE ,
RS1.SUPPORT_DOCUMENT_NO ,
RS1.SUPPORT_AMOUNT ,
RS.SURVEY_STATUS_ID, SS.STATUS_NAME
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_PUBLIC.REG_SURVEY RS ON FA.ID = RS.SURVEY_AUDIT_ID
INNER JOIN AUD_PUBLIC.REG_SURVEY_2_3 RS1 ON RS.ID = RS1.SURVEY_ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON NVL(EE.UPDATED_BY, EE.CREATED_BY) = SU.USER_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_STATUS SS ON RS.SURVEY_STATUS_ID = SS.ID
WHERE FA.IS_ACTIVE = 1 AND RS1.IS_ACTIVE = 1 AND FA.ID != 3322`;

async function postZad23(context) {
  let query = baseZad23Query;

  const binds = {};
  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY FA.CHECK_DEPARTMENT_ID, RS.ID, AO.ORG_REGISTER_NO`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postZad23 = postZad23;

const baseZad03Query = `SELECT FA.CHECK_DEPARTMENT_ID, CD.DEPARTMENT_NAME, 
SU.USER_NAME ||'-'|| SU.USER_CODE AUDITOR_NAME,
AE.ENT_NAME, AO.ORG_REGISTER_NO, RBT.BUDGET_SHORT_NAME, 
RS1.person_lastname, 
RS1.person_firstname, 
RS1.person_role, 
RS1.person_role_level, 
RS1.working_room, 
RS1.resting_room, 
RS1.toilet, 
RS1.meeting_room,
RS1.other_room, 
RS1.total_area,
RS.SURVEY_STATUS_ID, SS.STATUS_NAME
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_PUBLIC.REG_SURVEY RS ON FA.ID = RS.SURVEY_AUDIT_ID
INNER JOIN AUD_PUBLIC.REG_SURVEY_3 RS1 ON RS.ID = RS1.SURVEY_ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON NVL(EE.UPDATED_BY, EE.CREATED_BY) = SU.USER_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_STATUS SS ON RS.SURVEY_STATUS_ID = SS.ID
WHERE FA.IS_ACTIVE = 1 AND RS1.IS_ACTIVE = 1 AND FA.ID != 3322`;

async function postZad03(context) {
  let query = baseZad03Query;

  const binds = {};
  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY FA.CHECK_DEPARTMENT_ID, RS.ID, AO.ORG_REGISTER_NO`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postZad03 = postZad03;

const baseZad04Query = `SELECT FA.CHECK_DEPARTMENT_ID, CD.DEPARTMENT_NAME, 
SU.USER_NAME ||'-'|| SU.USER_CODE AUDITOR_NAME,
AE.ENT_NAME, AO.ORG_REGISTER_NO, RBT.BUDGET_SHORT_NAME,
RS1.RENT_POSITION,
RS1.RENT_REGISTER_NO,
RS1.RENT_ORG_NAME,
RIT.INVEST_TYPE_NAME,
RS1.CONTRACT_NO,
RS1.RENT_SIZE,
RS1.RENT_SQUARE_AMOUNT,
RS1.RENT_TOTAL_AMOUNT,
RS1.RENT_DESCRIPTION,
RS.SURVEY_STATUS_ID, SS.STATUS_NAME
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_PUBLIC.REG_SURVEY RS ON FA.ID = RS.SURVEY_AUDIT_ID
INNER JOIN AUD_PUBLIC.REG_SURVEY_4 RS1 ON RS.ID = RS1.SURVEY_ID
LEFT JOIN AUD_PUBLIC.REF_INVEST_TYPE RIT ON RS1.INVEST_TYPE_ID = RIT.ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON NVL(EE.UPDATED_BY, EE.CREATED_BY) = SU.USER_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_STATUS SS ON RS.SURVEY_STATUS_ID = SS.ID
WHERE FA.IS_ACTIVE = 1 AND RS1.IS_ACTIVE = 1 AND FA.ID != 3322`;

async function postZad04(context) {
  let query = baseZad04Query;

  const binds = {};
  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY FA.CHECK_DEPARTMENT_ID, RS.ID, AO.ORG_REGISTER_NO`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postZad04 = postZad04;

const baseZad05Query = `SELECT FA.CHECK_DEPARTMENT_ID, CD.DEPARTMENT_NAME, 
SU.USER_NAME ||'-'|| SU.USER_CODE AUDITOR_NAME,
AE.ENT_NAME, AO.ORG_REGISTER_NO, RBT.BUDGET_SHORT_NAME, 
RS1.donation_date,
RS1.donation_value,
RS1.project_intent,
RS1.project_name,
RS1.project_code,
RS1.project_intent_name,
RS1.project_intent_code,
RS1.contract_amount,
RS1.contract_period,
RS1.cy_invest_amount,
CASE WHEN RS1.is_conclution = 1 THEN 'Тийм' ELSE 'Үгүй' END is_conclution,
CASE WHEN RS1.is_required = 1 THEN 'Тийм' ELSE 'Үгүй' END is_required,
RS1.invest_description,
RS1.ngo_register_no,
RS1.ngo_name,
RS1.ngo_activity,
RS1.ngo_contact,
RS1.ngo_email,
RS1.ngo_head_lastname,
RS1.ngo_head_firstname,
RS.SURVEY_STATUS_ID, SS.STATUS_NAME
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_PUBLIC.REG_SURVEY RS ON FA.ID = RS.SURVEY_AUDIT_ID
INNER JOIN AUD_PUBLIC.REG_SURVEY_5 RS1 ON RS.ID = RS1.SURVEY_ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON NVL(EE.UPDATED_BY, EE.CREATED_BY) = SU.USER_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_STATUS SS ON RS.SURVEY_STATUS_ID = SS.ID
WHERE FA.IS_ACTIVE = 1 AND RS1.IS_ACTIVE = 1 AND FA.ID != 3322`;

async function postZad05(context) {
  let query = baseZad05Query;

  const binds = {};
  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY FA.CHECK_DEPARTMENT_ID, RS.ID, AO.ORG_REGISTER_NO`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postZad05 = postZad05;

const baseZad06Query = `SELECT FA.CHECK_DEPARTMENT_ID, CD.DEPARTMENT_NAME, 
SU.USER_NAME ||'-'|| SU.USER_CODE AUDITOR_NAME,
AE.ENT_NAME, AO.ORG_REGISTER_NO, RBT.BUDGET_SHORT_NAME, 
RS1.DONATER_NAME,
RDT.DONATION_TYPE_NAME,
RS1.DONATION_AMOUNT,
RS1.ACCOUNT_NAME,
RS1.ACCOUNT_AMOUNT,
RS1.COST_DATE,
RS1.COST_DOCUMENT_NO,
RS1.COST_AMOUNT,
RS1.COST_ERROR_AMOUNT,
RS1.C2_AMOUNT,
RS.SURVEY_STATUS_ID, SS.STATUS_NAME
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_PUBLIC.REG_SURVEY RS ON FA.ID = RS.SURVEY_AUDIT_ID
INNER JOIN AUD_PUBLIC.REG_SURVEY_6 RS1 ON RS.ID = RS1.SURVEY_ID
LEFT JOIN AUD_PUBLIC.REF_DONATION_TYPE RDT ON RS1.DONATION_TYPE_ID = RDT.ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON NVL(EE.UPDATED_BY, EE.CREATED_BY) = SU.USER_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_STATUS SS ON RS.SURVEY_STATUS_ID = SS.ID
WHERE FA.IS_ACTIVE = 1 AND RS1.IS_ACTIVE = 1 AND FA.ID != 3322`;

async function postZad06(context) {
  let query = baseZad06Query;

  const binds = {};
  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY FA.CHECK_DEPARTMENT_ID, RS.ID, AO.ORG_REGISTER_NO`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postZad06 = postZad06;

const baseZad07Query = `SELECT FA.CHECK_DEPARTMENT_ID, CD.DEPARTMENT_NAME, 
SU.USER_NAME ||'-'|| SU.USER_CODE AUDITOR_NAME,
AE.ENT_NAME, AO.ORG_REGISTER_NO, RBT.BUDGET_SHORT_NAME, --RS1.ID, RS1.SURVEY_ID,
RS1.hospital_name,
RS1.patient_count,
RS1.home_patient_count,
RS1.request_amount,
RS1.invested_amount,
RS1.total_cost_amount,
RS1.package_count,
RS1.package_amount,
RS1.protection_cost,
RS1.gas_cost,
RS1.phone_cost,
RS1.salary_cost,
RS1.process_cost,
RS1.prepare_cost,
RS1.other_cost,
RS1.receive_amount,
RS1.diff_amount,
RS1.package_c2_count,
RS1.package_c2_amount,
RS1.cost_description,
RS.SURVEY_STATUS_ID, SS.STATUS_NAME
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_PUBLIC.REG_SURVEY RS ON FA.ID = RS.SURVEY_AUDIT_ID
INNER JOIN AUD_PUBLIC.REG_SURVEY_7 RS1 ON RS.ID = RS1.SURVEY_ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON NVL(EE.UPDATED_BY, EE.CREATED_BY) = SU.USER_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_STATUS SS ON RS.SURVEY_STATUS_ID = SS.ID
WHERE FA.IS_ACTIVE = 1 AND RS1.IS_ACTIVE = 1 AND FA.ID != 3322`;

async function postZad07(context) {
  let query = baseZad07Query;

  const binds = {};
  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY FA.CHECK_DEPARTMENT_ID, RS.ID, AO.ORG_REGISTER_NO`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postZad07 = postZad07;

const baseZad08Query = `SELECT FA.CHECK_DEPARTMENT_ID, CD.DEPARTMENT_NAME, 
SU.USER_NAME ||'-'|| SU.USER_CODE AUDITOR_NAME,
AE.ENT_NAME, AO.ORG_REGISTER_NO, RBT.BUDGET_SHORT_NAME, 
RS1.CAR_MARK,
RS1.CAR_NUMBER,
RS1.CAR_ENGINE,
RCT.INTENT_TYPE_NAME,
RS1.CAR_USER,
RS1.CAR_GRANT_DATE,
RS1.DRIVER_ROLE,
RS1.DRIVER_SALARY,
RS1.ACTIVE_YEAR,
RS1.BALANCE_AMOUNT,
RS1.REASON_TYPE,
RS1.GAS_COST_AMOUNT,
RS1.GAS_COST_BUDGET,
RS1.SPARE_COST_AMOUNT,
RS1.SPARE_COST_BUDGET,
RS.SURVEY_STATUS_ID, SS.STATUS_NAME
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_PUBLIC.REG_SURVEY RS ON FA.ID = RS.SURVEY_AUDIT_ID
INNER JOIN AUD_PUBLIC.REG_SURVEY_8 RS1 ON RS.ID = RS1.SURVEY_ID
INNER JOIN AUD_PUBLIC.REF_CAR_INTENT_TYPE RCT ON RS1.CAR_INTENT_TYPE_ID = RCT.ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON NVL(EE.UPDATED_BY, EE.CREATED_BY) = SU.USER_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_STATUS SS ON RS.SURVEY_STATUS_ID = SS.ID
WHERE FA.IS_ACTIVE = 1 AND RS1.IS_ACTIVE = 1 AND FA.ID != 3322`;

async function postZad08(context) {
  let query = baseZad08Query;

  const binds = {};
  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY FA.CHECK_DEPARTMENT_ID, RS.ID, AO.ORG_REGISTER_NO`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postZad08 = postZad08;

const baseZad09Query = `SELECT FA.CHECK_DEPARTMENT_ID, CD.DEPARTMENT_NAME, 
SU.USER_NAME ||'-'|| SU.USER_CODE AUDITOR_NAME,
AE.ENT_NAME, AO.ORG_REGISTER_NO, RBT.BUDGET_SHORT_NAME,
RS1.athlete_lastname,
RS1.athlete_firstname,
RS1.athlete_role,
RS1.athlete_sport,
RS1.success_olympics,
RS1.success_world,
RS1.success_state,
RS1.salary_title_amount,
RS1.salary_base_amount,
RS1.salary_degree_amount,
RS1.promo_date,
RS1.promo_document_no,
RS1.promo_amount,
RS1.non_money_type,
RS1.non_money_price,
RS1.total_amount,
RS.SURVEY_STATUS_ID, SS.STATUS_NAME
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_PUBLIC.REG_SURVEY RS ON FA.ID = RS.SURVEY_AUDIT_ID
INNER JOIN AUD_PUBLIC.REG_SURVEY_9 RS1 ON RS.ID = RS1.SURVEY_ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON NVL(EE.UPDATED_BY, EE.CREATED_BY) = SU.USER_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_STATUS SS ON RS.SURVEY_STATUS_ID = SS.ID
WHERE FA.IS_ACTIVE = 1 AND RS1.IS_ACTIVE = 1 AND FA.ID != 3322`;

async function postZad09(context) {
  let query = baseZad09Query;

  const binds = {};
  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY FA.CHECK_DEPARTMENT_ID, RS.ID, AO.ORG_REGISTER_NO`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postZad09 = postZad09;

const baseZad10Query = `SELECT 
FA.CHECK_DEPARTMENT_ID, CD.DEPARTMENT_NAME, 
 SU.USER_NAME ||'-'|| SU.USER_CODE AUDITOR_NAME,
AE.ENT_NAME, AO.ORG_REGISTER_NO, RBT.BUDGET_SHORT_NAME,
RS1.media_name,
RS1.media_register_no,
RS1.media_type,
RS1.contract_name,
to_char(RS1.contract_date, 'yyyy-mm-dd') AS contract_date ,
RS1.contract_no,
to_char(RS1.begin_date, 'yyyy-mm-dd') AS begin_date ,
to_char(RS1.end_date, 'yyyy-mm-dd') AS end_date ,
RS1.contract_amount,
RS1.procurement_type,
RS1.cost_type,
CASE WHEN RS1.is_planned = 1 THEN 'Тийм' ELSE 'Үгүй' END is_planned,
CASE WHEN RS1.is_prev = 1 THEN 'Тийм' ELSE 'Үгүй' END is_prev,
RS.SURVEY_STATUS_ID, SS.STATUS_NAME
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_PUBLIC.REG_SURVEY RS ON FA.ID = RS.SURVEY_AUDIT_ID
INNER JOIN AUD_PUBLIC.REG_SURVEY_10 RS1 ON RS.ID = RS1.SURVEY_ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON NVL(EE.UPDATED_BY, EE.CREATED_BY) = SU.USER_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_STATUS SS ON RS.SURVEY_STATUS_ID = SS.ID
WHERE FA.IS_ACTIVE = 1 AND RS1.IS_ACTIVE = 1 AND FA.ID != 3322`;

async function postZad10(context) {
  let query = baseZad10Query;

  const binds = {};
  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY FA.CHECK_DEPARTMENT_ID, RS.ID, AO.ORG_REGISTER_NO`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postZad10 = postZad10;

//Negtgel tailan
const baseNeg01Query = `SELECT FA.CHECK_DEPARTMENT_ID, CD.DEPARTMENT_NAME, 
SU.USER_NAME ||'-'|| SU.USER_CODE AUDITOR_NAME,
AE_PARENT.ENT_NAME TEZ_NAME,
AE_TTZ.ENT_NAME TTZ_NAME,
NVL(FDD.IND_VALUE,AE.ENT_NAME) ENT_NAME, AO.ORG_REGISTER_NO, RBT.BUDGET_SHORT_NAME, 
RS1.BUDGET_AMOUNT, RS1.RUNNING_COST_AMOUNT, RS1.INVESTMENT_COST_AMOUNT, RS1.EXECUTION_AMOUNT, RS1.EXECUTION_RUNNING_COST, RS1.EXECUTION_INVESTMENT_COST, RS1.HEMNELT_DUN, 
RS1.NEW_EMP_COUNT, RS1.NEW_EMP_SALARY, RS1.RENEW_EMP_COUNT, RS1.RENEW_EMP_SALARY, RS1.IMP_SALARY_COUNT, RS1.IMP_SALARY_AMOUNT, RS1.IMP_PROMO_COUNT, RS1.IMP_PROMO_AMOUNT, RS1.IMP_GUEST_AMOUNT, RS1.IMP_GIFT_AMOUNT, 
RS1.CAR_COUNT, RS1.CAR_AMOUNT, RS1.FURNITURE_AMOUNT, RS1.CLOTHES_AMOUNT, RS1.OTHER_TOOLS_AMOUNT, RS1.EXTERNAL_EVENT_AMOUNT, RS1.INTERNAL_EVENT_AMOUNT, RS1.CEREMONY_AMOUNT, RS1.CONTENT_AMOUNT, RS1.BASE_PLAN_AMOUNT, 
RS1.BASE_COMPLETION_AMOUNT, RS1.DOCUMENT_PLAN_AMOUNT, RS1.DOCUMENT_COMPLETION_AMOUNT,
RS.SURVEY_STATUS_ID, SS.STATUS_NAME
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ENTITY AE_PARENT ON AE.ENT_TEZ = AE_PARENT.ENT_ID
LEFT JOIN AUD_ORG.AUDIT_ENTITY AE_TTZ ON AE.ENT_TTZ = AE_TTZ.ENT_ID
LEFT JOIN FAS_ADMIN.FAS_DOCUMENT_DATA FDD ON FA.ID = FDD.FAS_AUDIT_ID AND FDD.IS_ACTIVE = 1 AND FDD.IND_ID IN (287, 344)
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_PUBLIC.REG_SURVEY RS ON FA.ID = RS.SURVEY_AUDIT_ID
INNER JOIN AUD_PUBLIC.REG_SURVEY_1 RS1 ON RS.ID = RS1.SURVEY_ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON NVL(EE.UPDATED_BY, EE.CREATED_BY) = SU.USER_ID
LEFT JOIN AUD_PUBLIC.REF_SURVEY_STATUS SS ON RS.SURVEY_STATUS_ID = SS.ID
WHERE FA.IS_ACTIVE = 1 AND RS1.IS_ACTIVE = 1 AND FA.ID != 3322`;

async function postNeg01(context) {
  let query = baseNeg01Query;

  const binds = {};
  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY FA.CHECK_DEPARTMENT_ID, AO.ORG_REGISTER_NO, AE_PARENT.ENT_NAME, AE_TTZ.ENT_NAME, RBT.BUDGET_SHORT_NAME, RS.ID`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postNeg01 = postNeg01;

const baseNeg21Query = `SELECT FA.CHECK_DEPARTMENT_ID, CD.DEPARTMENT_NAME,   
SU.USER_NAME ||'-'|| SU.USER_CODE AUDITOR_NAME,
AE_PARENT.ENT_NAME TEZ_NAME,
AE_TTZ.ENT_NAME TTZ_NAME,
NVL(FDD.IND_VALUE,AE.ENT_NAME) ENT_NAME, AO.ORG_REGISTER_NO, RBT.BUDGET_SHORT_NAME,
RB.BRANCH_NAME ,
RS1.ACTIVITY_NAME ,
(CASE WHEN RS1.HOLDING_PERCENT <= 50 THEN 'Тийм' END) PER50,
(CASE WHEN RS1.HOLDING_PERCENT > 50 THEN 'Тийм' END) PER100,
(CASE WHEN RS1.IS_LEGAL18 = 1 THEN 'Тийм' END) IS_LEGAL18_YES,
(CASE WHEN RS1.IS_LEGAL18 = 2 THEN 'Тийм' END) IS_LEGAL18_NO,
RS1.REG_CAPITAL_AMOUNT,
RS1.STATE_CAPITAL_AMOUNT,
RS1.HEAD_EMPLOYEE,
RS1.MIDDLE_EMPLOYEE,
RS1.NORMAL_EMPLOYEE,
RS1.HEAD_EMPLOYEE + RS1.MIDDLE_EMPLOYEE + RS1.NORMAL_EMPLOYEE TOTAL_EMPLOYEE ,
RS1.PROFIT_PLAN ,
RS1.PROFIT_COMPLETION ,
RS1.PROFIT_PLAN - RS1.PROFIT_COMPLETION PROFIT_MARGIN,
(CASE WHEN RS1.TARGET_LEVEL = 1 THEN 'Тийм' END) TARGET_LEVEL_YES,
(CASE WHEN RS1.TARGET_LEVEL = 2 THEN 'Тийм' END) TARGET_LEVEL_NO,
RS1.TARGET_LEVEL_PERCENT,
RS1.PREV_INCOME,
RS1.PREV_PROCESS_COST ,
RS1.PREV_NON_PROCESS_COST ,
RS1.PREV_INCOME_TAX ,
RS1.PREV_PROFIT ,
RS1.PREV_DESCRIPTION ,
RS1.CY_INCOME ,
RS1.CY_PROCESS_COST ,
RS1.CY_NON_PROCESS_COST ,
RS1.CY_INCOME_TAX ,
RS1.CY_PROFIT ,
RS1.CY_DESCRIPTION ,
(CASE WHEN RS1.IS_STATE = 1 THEN 'Тийм' END) IS_STATE_YES,
(CASE WHEN RS1.IS_STATE = 2 THEN 'Тийм' END) IS_STATE_NO,
(CASE WHEN RS1.IS_CHANGE = 1 THEN 'Тийм' END) IS_CHANGE_YES,
(CASE WHEN RS1.IS_CHANGE = 2 THEN 'Тийм' END) IS_CHANGE_NO,
(CASE WHEN RS1.IS_LINKED = 1 THEN 'Тийм' END) IS_LINKED_YES,
(CASE WHEN RS1.IS_LINKED = 2 THEN 'Тийм' END) IS_LINKED_NO,
(CASE WHEN RS1.IS_SCOPED = 1 THEN 'Тийм' END) IS_SCOPED_YES,
(CASE WHEN RS1.IS_SCOPED = 2 THEN 'Тийм' END) IS_SCOPED_NO,
RS1.PREV_SALARY_COST ,
RS1.PREV_PROMOTION_COST ,
RS1.PREV_GUEST_COST ,
RS1.CY_SALARY_COST ,
RS1.CY_PROMOTION_COST ,
RS1.CY_GUEST_COST
FROM FAS_ADMIN.FAS_AUDIT FA
INNER JOIN AUD_ORG.AUDIT_ENTITY AE ON FA.ENT_ID = AE.ENT_ID
INNER JOIN AUD_ORG.AUDIT_ENTITY AE_PARENT ON AE.ENT_TEZ = AE_PARENT.ENT_ID
LEFT JOIN AUD_ORG.AUDIT_ENTITY AE_TTZ ON AE.ENT_TTZ = AE_TTZ.ENT_ID
LEFT JOIN FAS_ADMIN.FAS_DOCUMENT_DATA FDD ON FA.ID = FDD.FAS_AUDIT_ID AND FDD.IS_ACTIVE = 1 AND FDD.IND_ID IN (287, 344)
INNER JOIN AUD_ORG.AUDIT_ORGANIZATION AO ON AE.ENT_ORG_ID = AO.ORG_ID
INNER JOIN AUD_ORG.REF_BUDGET_TYPE RBT ON AE.ENT_BUDGET_TYPE = RBT.BUDGET_TYPE_ID
INNER JOIN FAS_ADMIN.REF_CHECK_DEPARTMENT CD ON FA.CHECK_DEPARTMENT_ID = CD.ID
INNER JOIN AUD_PUBLIC.REG_SURVEY RS ON FA.ID = RS.SURVEY_AUDIT_ID
INNER JOIN AUD_PUBLIC.REG_SURVEY_2_1 RS1 ON RS.ID = RS1.SURVEY_ID
INNER JOIN AUD_PUBLIC.REF_BRANCH RB ON RS1.BRANCH_ID = RB.ID
LEFT JOIN FAS_ADMIN.FAS_ENT_EMAIL EE ON FA.ENT_ID = EE.ENT_ID
LEFT JOIN AUD_REG.SYSTEM_USER SU ON NVL(EE.UPDATED_BY, EE.CREATED_BY) = SU.USER_ID
WHERE FA.IS_ACTIVE = 1 AND RS1.IS_ACTIVE = 1 AND FA.ID != 3322`;

async function postNeg21(context) {
  let query = baseNeg21Query;

  const binds = {};
  if (context.dep_id != null) {
    binds.DEPARTMENT_ID = context.dep_id;
    query += `\nAND FA.CHECK_DEPARTMENT_ID = :DEPARTMENT_ID`;
  }
  query += `\nORDER BY FA.CHECK_DEPARTMENT_ID, AO.ORG_REGISTER_NO, AE_PARENT.ENT_NAME, AE_TTZ.ENT_NAME, RBT.BUDGET_SHORT_NAME, RS.ID`;
  const result = await database.simpleExecute(query, binds);

  return result.rows;
}

module.exports.postNeg21 = postNeg21;
